<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Universal Cookie Converter</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7; }
    textarea, select, button { width: 100%; margin-top: 10px; font-size: 16px; }
    #output { background: #eef; padding: 10px; margin-top: 10px; white-space: pre-wrap; word-break: break-all; min-height: 2em; }
    button { padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    .controls { display: flex; gap: 10px; }
    .controls > * { flex: 1; }
  </style>
</head>
<body>
  <h2>🍪 Cookie Conversion Admin: @Dzzmanhjay</h2>
  
  <label for="input">Dán cookie (JSON / Netscape / Cookie String) vào đây:</label>
  <textarea id="input" rows="8" placeholder='Paste JSON, hoặc Netscape (.txt), hoặc "name=value; name2=value2"'></textarea>
  
  <div class="controls">
    <select id="outputType">
      <option value="string">Cookie String</option>
      <option value="json">JSON</option>
      <option value="netscape">Netscape</option>
    </select>
    <button onclick="convert()">Conversion</button>
  </div>
  
  <button onclick="copyResult()">📋 Copy Results</button>
  
  <h3>Result:</h3>
  <div id="output"></div>
  
  <script>
    function detectAndParse(text) {
      text = text.trim();
      // 1. JSON?
      try {
        const arr = JSON.parse(text);
        if (Array.isArray(arr) && arr.every(c => c.name && c.value)) {
          return arr.map(c => ({
            name: c.name,
            value: c.value,
            domain: c.domain || ".",
            path: c.path || "/",
            expires: c.expires || 2147483647,
            secure: c.secure || false,
            httpOnly: c.httpOnly || false
          }));
        }
      } catch {}
      // 2. Netscape?
      const lines = text.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('#'));
      if (lines.length && lines.every(l => l.split('\t').length >= 7)) {
        return lines.map(l => {
          const p = l.split('\t');
          return {
            domain: p[0],
            path: p[2],
            secure: p[3].toUpperCase() === "TRUE",
            expires: parseInt(p[4], 10) || 2147483647,
            name: p[5],
            value: p[6],
            httpOnly: p[0].startsWith("#HttpOnly_")
          };
        });
      }
      // 3. Cookie String?
      const parts = text.split(';').map(s => s.trim()).filter(s => s.includes('='));
      if (parts.length) {
        return parts.map(s => {
          const [n, ...rest] = s.split('=');
          return { name: n.trim(), value: rest.join('=').trim(), domain:".", path:"/", expires:2147483647, secure:false, httpOnly:false };
        });
      }
      throw new Error("Không nhận diện được định dạng đầu vào.");
    }
    
    function convert() {
      const inp = document.getElementById("input").value;
      const outType = document.getElementById("outputType").value;
      let cookies;
      try {
        cookies = detectAndParse(inp);
      } catch (e) {
        return document.getElementById("output").innerText = "❌ Lỗi: " + e.message;
      }
      
      let result = "";
      if (outType === "json") {
        result = JSON.stringify(cookies.map(c => ({
          name: c.name,
          value: c.value,
          domain: c.domain,
          path: c.path,
          expires: c.expires,
          secure: c.secure,
          httpOnly: c.httpOnly
        })), null, 2);
      } else if (outType === "netscape") {
        result = cookies.map(c => 
          `${c.domain}\tTRUE\t${c.path}\t${c.secure?"TRUE":"FALSE"}\t${c.expires}\t${c.name}\t${c.value}`
        ).join("\n");
      } else { // string
        result = cookies.map(c => `${c.name}=${c.value}`).join("; ");
      }
      
      document.getElementById("output").innerText = result;
    }
    
    function copyResult() {
      const txt = document.getElementById("output").innerText;
      if (!txt) return alert("❌ Chưa có kết quả để copy!");
      navigator.clipboard.writeText(txt)
        .then(() => alert("✅ Đã sao chép vào clipboard!"))
        .catch(() => alert("❌ Không thể sao chép!"));
    }
  </script>
</body>
</html>
