<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Cookie Conversion Utility</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: #f5f5f7;
      color: #1c1c1e;
      min-height: 100vh;
      margin: 0;
      padding: 30px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    h1 {
      margin-bottom: 5px;
      font-weight: 700;
      font-size: 2.4rem;
      color: #111;
    }
    p.subtitle {
      margin-top: 0;
      margin-bottom: 25px;
      font-weight: 400;
      font-size: 1.1rem;
      max-width: 600px;
      text-align: center;
      color: #555;
    }
    .container {
      background: #fff;
      border-radius: 12px;
      padding: 30px 30px 35px;
      max-width: 700px;
      width: 100%;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
    }
    label {
      font-weight: 600;
      font-size: 1.05rem;
      display: block;
      margin-bottom: 8px;
      color: #222;
    }
    input[type="file"] {
      padding: 12px 10px;
      width: 100%;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      font-weight: 500;
      background: #fafafa;
      color: #111;
      cursor: pointer;
      transition: border-color 0.3s ease;
    }
    input[type="file"]:hover {
      border-color: #666;
    }
    select {
      width: 100%;
      padding: 12px 15px;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      background: #fafafa;
      color: #111;
      font-weight: 600;
      font-size: 1rem;
      transition: border-color 0.3s ease;
      margin-top: 6px;
      margin-bottom: 20px;
    }
    select:hover {
      border-color: #666;
    }
    .button-row {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }
    button {
      flex: 1;
      padding: 14px 0;
      font-size: 1.15rem;
      font-weight: 700;
      border-radius: 10px;
      border: none;
      background: #333;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transition: background 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background: #555;
      box-shadow: 0 6px 18px rgba(0,0,0,0.3);
    }
    button:disabled {
      background: #bbb;
      cursor: not-allowed;
      box-shadow: none;
      color: #666;
    }
    #output {
      background: #f0f0f0;
      border-radius: 12px;
      padding: 20px;
      max-height: 350px;
      overflow-y: auto;
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9rem;
      line-height: 1.4;
      border: 1.5px solid #ccc;
      white-space: pre-wrap;
      word-break: break-word;
      user-select: text;
      color: #333;
    }
    @media (max-width: 480px) {
      .button-row {
        flex-direction: column;
      }
      button {
        font-size: 1rem;
        padding: 12px 0;
      }
    }
  </style>
</head>
<body>
  <h1>üç™ Cookie Conversion Utility</h1>
  <p class="subtitle">Ch·ªçn Folder File Bot - T·∫•t C·∫£ </p>
  
  <div class="container">
    <label for="folderInput">Select folder::</label>
    <input type="file" id="folderInput" webkitdirectory directory multiple />
    
    <label for="formatSelect">Ch·ªçn ƒë·ªãnh d·∫°ng convert:</label>
    <select id="formatSelect">
      <option value="string">Cookie String</option>
      <option value="json">JSON</option>
      <option value="netscape">Netscape</option>
    </select>
    
    <div class="button-row">
      <button id="processBtn" disabled>Start</button>
      <button id="downloadBtn" style="display:none;">Download .Zip</button>
    </div>
    
    <pre id="output">Ch∆∞a c√≥ file n√†o ƒë∆∞·ª£c ch·ªçn.</pre>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    const folderInput = document.getElementById('folderInput');
    const formatSelect = document.getElementById('formatSelect');
    const processBtn = document.getElementById('processBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const output = document.getElementById('output');

    let filesToProcess = [];
    let zip = new JSZip();

    function detectAndParse(text) {
      text = text.trim();
      try {
        const arr = JSON.parse(text);
        if (Array.isArray(arr) && arr.every(c => c.name && c.value)) {
          return arr.map(c => ({
            name: c.name,
            value: c.value,
            domain: c.domain || ".",
            path: c.path || "/",
            expires: c.expires || 2147483647,
            secure: c.secure || false,
            httpOnly: c.httpOnly || false
          }));
        }
      } catch {}
      const lines = text.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('#'));
      if (lines.length && lines.every(l => l.split('\t').length >= 7)) {
        return lines.map(l => {
          const p = l.split('\t');
          return {
            domain: p[0],
            path: p[2],
            secure: p[3].toUpperCase() === "TRUE",
            expires: parseInt(p[4], 10) || 2147483647,
            name: p[5],
            value: p[6],
            httpOnly: p[0].startsWith("#HttpOnly_")
          };
        });
      }
      const parts = text.split(';').map(s => s.trim()).filter(s => s.includes('='));
      if (parts.length) {
        return parts.map(s => {
          const [n, ...rest] = s.split('=');
          return { name: n.trim(), value: rest.join('=').trim(), domain:".", path:"/", expires:2147483647, secure:false, httpOnly:false };
        });
      }
      throw new Error("Kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c ƒë·ªãnh d·∫°ng cookie trong file.");
    }

    function convertCookies(cookies, format) {
      if (format === "json") {
        return JSON.stringify(cookies.map(c => ({
          name: c.name,
          value: c.value,
          domain: c.domain,
          path: c.path,
          expires: c.expires,
          secure: c.secure,
          httpOnly: c.httpOnly
        })), null, 2);
      } else if (format === "netscape") {
        return cookies.map(c => 
          `${c.domain}\tTRUE\t${c.path}\t${c.secure ? "TRUE" : "FALSE"}\t${c.expires}\t${c.name}\t${c.value}`
        ).join("\n");
      } else { // string
        return cookies.map(c => `${c.name}=${c.value}`).join("; ");
      }
    }

    folderInput.addEventListener('change', () => {
      filesToProcess = Array.from(folderInput.files).filter(f => f.name === 'Cookies_JSON.txt');
      output.textContent = '';
      downloadBtn.style.display = 'none';
      processBtn.disabled = true;
      if (filesToProcess.length > 0) {
        processBtn.disabled = false;
        output.textContent = ` T√¨m th·∫•y ${filesToProcess.length} file cookie\n`;
      } else {
        output.textContent = 'Kh√¥ng t√¨m th·∫•y file Cookie n√†o trong th∆∞ m·ª•c b·∫°n ch·ªçn.';
      }
    });

    processBtn.addEventListener('click', () => {
      output.textContent = '‚è≥ ƒêang x·ª≠ l√Ω...';
      zip = new JSZip();
      let count = 0;
      filesToProcess.sort((a, b) => {
        const dirA = a.webkitRelativePath.split('/')[0].toLowerCase();
        const dirB = b.webkitRelativePath.split('/')[0].toLowerCase();
        return dirA.localeCompare(dirB);
      });

      filesToProcess.forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const rawText = e.target.result;
          let cookies;
          try {
            cookies = detectAndParse(rawText);
          } catch (err) {
            output.textContent += `\nFile ${file.webkitRelativePath} l·ªói parse cookie: ${err.message}`;
            count++;
            if (count === filesToProcess.length) {
              finishZip();
            }
            return;
          }

          const converted = convertCookies(cookies, formatSelect.value);
          const folderName = file.webkitRelativePath.split('/')[0];
          const order = String(index + 1).padStart(2, '0');
          const fileName = `${order}_${folderName}_Cookies_${formatSelect.value}.txt`;

          zip.file(fileName, converted);

          output.textContent += `\n${order}. ${file.webkitRelativePath} ‚Üí ${fileName}`;

          count++;
          if (count === filesToProcess.length) {
            finishZip();
          }
        };
        reader.readAsText(file);
      });

      function finishZip() {
        output.textContent += '\n\nX·ª≠ l√Ω ho√†n t·∫•t! B·∫°n c√≥ th·ªÉ t·∫£i file ZIP.';
        downloadBtn.style.display = 'inline-block';
        processBtn.disabled = true;
      }
    });

    downloadBtn.addEventListener('click', () => {
      downloadBtn.disabled = true;
      output.textContent += '\n‚è≥ ƒêang t·∫°o file ZIP...';

      zip.generateAsync({ type: "blob" }).then(content => {
        const link = document.createElement('a');
        link.href = URL.createObjectURL(content);
        link.download = 'Cookies_Converted_Files.zip';
        link.click();
        downloadBtn.disabled = false;
        output.textContent += '\nƒê√£ t·∫£i xong.';
      });
    });
  </script>
</body>
</html>
